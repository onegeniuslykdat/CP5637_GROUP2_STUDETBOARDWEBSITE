/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

tribe.tickets=tribe.tickets||{},tribe.tickets.admin=tribe.tickets.admin||{},tribe.dialogs=tribe.dialogs||{},tribe.dialogs.events=tribe.dialogs.events||{},tribe.tickets.admin.commerceSettings={},function($,_,obj){const $document=$(document);obj.selectors={connectButton:"#js-give-paypal-on-boarding-handler",connectButtonWrap:".connect-button-wrap",connectionSettingContainer:"#give-paypal-commerce-account-manager-field-wrap .connection-setting",container:"#tribe-field-tickets-commerce-paypal-commerce-configure",countrySelect:"#tickets-commerce-paypal-commerce-account-country-select",errorMessageTemplate:".paypal-message-template",disconnectionSettingContainer:"#give-paypal-commerce-account-manager-field-wrap .disconnection-setting",disconnectPayPalAccountButton:"#js-give-paypal-disconnect-paypal-account",troubleNotice:"#give-paypal-onboarding-trouble-notice",webHookSetUpLink:"#tec-tickets__admin-settings-webhook-set-up"},obj.observePayPalModal=function(){obj.paypalErrorQuickHelp=$(obj.selectors.troubleNotice);new MutationObserver((function(mutationsRecord){mutationsRecord.forEach((function(record){record.removedNodes.forEach((function(node){"PPMiniWin"===node.getAttribute("id")&&obj.paypalErrorQuickHelp[0]&&obj.paypalErrorQuickHelp.removeClass("tribe-common-a11y-hidden")}))}))})).observe(document.querySelector("body"),{attributes:!0,childList:!0})},obj.maybeShowModalAfterConnection=function(){(window.location.search.match(/tc-status=paypal-signup-complete/i)||window.location.search.match(/tc-status=stripe-signup-complete/i))&&tribe.dialogs.dialogs.forEach((function(dialog){"paypal-connected-modal-id"===dialog.id&&dialog.a11yInstance.show(),"stripe-connected-modal-id"===dialog.id&&dialog.a11yInstance.show(),dialog.a11yInstance.node.querySelectorAll('[data-js="a11y-close-button"]').forEach((function(closeButton){$(closeButton).on("click",(function(){dialog.a11yInstance.hide()}))}))}))},obj.setupPartnerLink=function(partnerLink){const payPalLink=document.querySelector("[data-paypal-button]");payPalLink.href=partnerLink+"&displayMode=minibrowser",payPalLink.click(),obj.observePayPalModal()},obj.requestPartnerUrl=function(countryCode){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_get_partner_url&country_code="+countryCode).then((function(response){return response.json()})).then((function(res){!0===res.success&&obj.setupPartnerLink(res.data.partnerLink),obj.buttonState.enable()})).then((function(){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_onboarding_trouble_notice").then((function(response){return response.json()})).then((function(res){if(!0!==res.success)return;const buttonContainer=document.querySelector(obj.selectors.connectButtonWrap);obj.paypalErrorQuickHelp[0]&&obj.paypalErrorQuickHelp.remove(),buttonContainer.append(function createElementFromHTML(htmlString){const div=document.createElement("div");return div.innerHTML=htmlString.trim(),div.firstChild}(res.data))}))}))},obj.removeErrors=function(){const errorsContainer=document.querySelector(obj.selectors.errorMessageTemplate);errorsContainer&&errorsContainer.parentElement.remove()},obj.buttonState={enable:function(){obj.onBoardingButton.attr("disabled",!1),obj.onBoardingButton.text(obj.onBoardingButton.data("initial-label"))},disable:function(){obj.onBoardingButton.data("initial-label")||obj.onBoardingButton.data("initial-label",obj.onBoardingButton.text().trim()),obj.onBoardingButton.attr("disabled",!0),obj.onBoardingButton.text("Processing text here")}},obj.handleConnectClick=function(evt){evt.preventDefault(),obj.removeErrors();const countryCode=$(obj.selectors.countrySelect).val();obj.buttonState.disable(),obj.paypalErrorQuickHelp=$(obj.selectors.troubleNotice),obj.paypalErrorQuickHelp[0]&&obj.paypalErrorQuickHelp.addClass("tribe-common-a11y-hidden"),obj.requestPartnerUrl(countryCode)},obj.handleDisconnectClick=function(evt){evt.preventDefault(),obj.removeErrors(),$(obj.selectors.connectionSettingContainer).removeClass("tribe-common-a11y-hidden"),$(obj.selectors.disconnectionSettingContainer).addClass("tribe-common-a11y-hidden"),fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_disconnect_account")},obj.onBoardCallback=function(authCode,sharedId){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_user_on_boarded"+("&authCode="+authCode+"&sharedId="+sharedId)).then((function(res){return res.json()})).then((function(res){!0===res.success?(obj.paypalErrorQuickHelp=$(obj.selectors.troubleNotice),obj.paypalErrorQuickHelp[0]&&obj.paypalErrorQuickHelp.remove()):alert("Something went wrong while we were connecting your account, please try again.")}))},obj.onWebHookSetUpLinkClick=function(evt){evt.preventDefault();const target=$(evt.target);$document.find("#tec-tickets-webhook-creation-update").remove(),$(`<p id="tec-tickets-webhook-creation-update" class="tooltip description">\n\t\t\t<span class="dashicons dashicons-update"></span>\n\t\t\t<span>${target.attr("data-loading-text")}</span>\n\t\t\t</p>`).insertAfter(target.closest("p")),fetch(target.attr("href")).then((function(res){return res.json()})).then((function(res){const updateEle=$("#tec-tickets-webhook-creation-update"),updateDashIcon=updateEle.find("span.dashicons");updateEle.find("span:not(.dashicons)").text(res.data.status),updateDashIcon.removeClass("dashicons-update"),!0===res.success?(updateDashIcon.addClass("dashicons-yes"),setTimeout((function(){window.location.reload()}),700)):updateDashIcon.addClass("dashicons-no")}))},obj.ready=function(){obj.onBoardingButton=$(obj.selectors.connectButton),obj.disconnectButton=$(obj.selectors.disconnectPayPalAccountButton),obj.setUpWebhookLink=$(obj.selectors.webHookSetUpLink),obj.onBoardingButton[0]&&obj.onBoardingButton.on("click",obj.handleConnectClick),obj.disconnectButton[0]&&obj.disconnectButton.on("click",obj.handleDisconnectClick),obj.setUpWebhookLink[0]&&obj.setUpWebhookLink.on("click",obj.onWebHookSetUpLinkClick),obj.maybeShowModalAfterConnection()},$document.ready(obj.ready)}(jQuery,window.underscore||window._,tribe.tickets.admin.commerceSettings);
/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

tribe.tickets.commerce.gateway.paypal=tribe.tickets.commerce.gateway.paypal||{},tribe.tickets.commerce.gateway.paypal.checkout={},function($,obj){"use strict";const $document=$(document);obj.orderEndpointUrl=tecTicketsCommerceGatewayPayPalCheckout.orderEndpoint,obj.advancedPayments=tecTicketsCommerceGatewayPayPalCheckout.advancedPayments,obj.timeouts=[],obj.isGenericError=!0,obj.selectors={paypalGatewayContainer:".tribe-tickets__commerce-checkout-paypal",checkoutScript:".tec-tc-gateway-paypal-checkout-script",activePayment:".tec-tc-gateway-paypal-payment-active",buttons:"#tec-tc-gateway-paypal-checkout-buttons",advancedPayments:{container:".tribe-tickets__commerce-checkout-paypal-advanced-payments-container",form:".tribe-tickets__commerce-checkout-paypal-advanced-payments-form",cardField:"#tec-tc-card-number",cvvField:"#tec-tc-cvv",nameField:"#tec-tc-card-holder-name",expirationField:"#tec-tc-expiration-date"},hiddenElement:".tribe-common-a11y-hidden"},obj.handleCancel=function(data,$container){tribe.tickets.debug.log("handleCancel",arguments),$container.removeClass(obj.selectors.activePayment.className()),obj.triggerCancelOrder($container,data.orderID,null,null)},obj.handleGenericError=function(error,$container){obj.isGenericError?(tribe.tickets.debug.log("handleGenericError",arguments),$container.removeClass(obj.selectors.activePayment.className()),obj.showNotice($container,error.title,error.content)):obj.isGenericError=!0},obj.handleClick=function($container){tribe.tickets.debug.log("handleClick",arguments),$container.addClass(obj.selectors.activePayment.className()),obj.hideNotice($container)},obj.handleCreateOrder=function(data,actions,$container){return tribe.tickets.debug.log("handleCreateOrder",arguments),fetch(obj.orderEndpointUrl,{method:"POST",body:JSON.stringify({purchaser:tribe.tickets.commerce.getPurchaserData($container)}),headers:{"X-WP-Nonce":$container.find(tribe.tickets.commerce.selectors.nonce).val(),"Content-Type":"application/json"}}).then((response=>response.json())).then((data=>(tribe.tickets.debug.log(data),data.success?obj.handleCreateOrderSuccess($container,data):obj.handleCreateOrderFail($container,data)))).catch((()=>{obj.handleCreateOrderError($container)}))},obj.handleCreateOrderSuccess=function($container,data){return tribe.tickets.debug.log("handleCreateOrderSuccess",arguments),data.id},obj.handleCreateOrderFail=function($container,data){tribe.tickets.debug.log("handleCreateOrderFail",arguments),obj.showNotice($container,data.message,""),obj.isGenericError=!1},obj.handleCreateOrderError=function($container,error){tribe.tickets.debug.log("handleCreateOrderError",arguments)},obj.handleCheckSuccess=function(data,actions,$container){tribe.tickets.debug.log("handleCheckSuccess",arguments);return fetch(obj.orderEndpointUrl+"/"+data.order_id,{method:"POST",headers:{"X-WP-Nonce":$container.find(tribe.tickets.commerce.selectors.nonce).val(),"Content-Type":"application/json"},body:JSON.stringify({recheck:!0})}).then((response=>response.json())).then((data=>data.success?obj.handleApproveSuccess(data,actions,$container):obj.handleApproveFail(data,actions,$container))).catch(obj.handleApproveError)},obj.handleApprove=function(data,actions,$container){tribe.tickets.debug.log("handleApprove",arguments);const body={payer_id:data.payerID??""};return fetch(obj.orderEndpointUrl+"/"+data.orderID,{method:"POST",headers:{"X-WP-Nonce":$container.find(tribe.tickets.commerce.selectors.nonce).val(),"Content-Type":"application/json"},body:JSON.stringify(body)}).then((response=>response.json())).then((data=>data.success?obj.handleCheckSuccess(data,actions,$container):obj.handleApproveFail(data,actions,$container))).catch(obj.handleApproveError)},obj.handleApproveSuccess=(data,actions,$container)=>{tribe.tickets.debug.log("handleApproveSuccess",data,actions),window.location.replace(data.redirect_url)},obj.handleApproveFail=(data,actions,$container)=>{tribe.tickets.debug.log("handleApproveFail",data,actions),"UNPROCESSABLE_ENTITY"===data.data.name&&"INSTRUMENT_DECLINED"===data.data.details[0].issue?obj.showNotice($container,"",data.data.details[0].description):obj.showNotice($container,"",data.message),tribe.tickets.loader.hide($container)},obj.handleApproveError=function(error){tribe.tickets.debug.log("handleApproveError",arguments)},obj.getButtonConfig=function($container){return{style:{layout:"vertical",shape:"rect",label:"paypal"},createOrder:(data,actions)=>obj.handleCreateOrder(data,actions,$container),onApprove:(data,actions)=>obj.handleApprove(data,actions,$container),onCancel:data=>obj.handleCancel(data,$container),onError:data=>obj.handleGenericError(data,$container),onClick:()=>obj.handleClick($container)}},obj.triggerCancelOrder=($container,orderId,status,reason)=>{const data={failed_status:status,failed_reason:reason};return $document.trigger(tribe.tickets.commerce.customEvents.showLoader),fetch(obj.orderEndpointUrl+"/"+orderId,{method:"DELETE",headers:{"X-WP-Nonce":$container.find(tribe.tickets.commerce.selectors.nonce).val()},body:JSON.stringify(data)}).then((response=>response.json())).then((data=>($document.trigger(tribe.tickets.commerce.customEvents.hideLoader),tribe.tickets.debug.log(data),data.success?obj.handleCancelOrderSuccess($container,data):obj.handleCancelOrderFail($container,data)))).catch((()=>{obj.handleCancelOrderError($container)}))},obj.handleCancelOrderSuccess=($container,data)=>{tribe.tickets.debug.log("handleCancelOrderSuccess",arguments),obj.showNotice($container,data.title,"")},obj.handleCancelOrderFail=($container,data)=>{tribe.tickets.debug.log("handleCancelOrderFail",arguments),obj.showNotice($container,data.title,"")},obj.handleCancelOrderError=$container=>{tribe.tickets.debug.log("handleCancelOrderError",arguments),obj.showNotice($container)},obj.timeoutRedirect=$container=>{$container.is(obj.selectors.activePayment.className())||window.location.replace(window.location.href)},obj.setupButtons=function(event,$container){paypal.Buttons(obj.getButtonConfig($container)).render(obj.selectors.buttons);const $checkoutScript=$container.find(obj.selectors.checkoutScript);if($checkoutScript.length&&$checkoutScript.is("[data-client-token-expires-in]")){const timeout=1e3*parseInt($checkoutScript.data("clientTokenExpiresIn"),10);obj.timeouts.push(setTimeout(obj.timeoutRedirect,timeout,$container))}},obj.buttonsLoaded=function(){$document.trigger(tribe.tickets.commerce.customEvents.hideLoader),obj.stopCheckoutObserving()},obj.showNotice=($container,title,content)=>{$container&&$container.length||($container=$(tribe.tickets.commerce.selectors.checkoutContainer));const notice=tribe.tickets.commerce.notice,$item=$container.find(notice.selectors.item);notice.populate($item,title,content),notice.show($item)},obj.hideNotice=$container=>{$container.length||($container=$(tribe.tickets.commerce.selectors.checkoutContainer));const notice=tribe.tickets.commerce.notice,$item=$container.find(notice.selectors.item);notice.hide($item)},obj.setupLoader=function(){$document.trigger(tribe.tickets.commerce.customEvents.showLoader),obj.startCheckoutObserving()},obj.startCheckoutObserving=()=>{const targetNode=$(tribe.tickets.commerce.selectors.checkoutContainer)[0];obj.checkoutContainerObserver=new MutationObserver((mutationsList=>{for(const mutation of mutationsList)if("childList"===mutation.type&&0!==mutation.addedNodes.length)for(const node of mutation.addedNodes)$(obj.selectors.buttons).find("iframe").length<=0||obj.buttonsLoaded.call(node)}));obj.checkoutContainerObserver.observe(targetNode,{childList:!0,subtree:!0})},obj.stopCheckoutObserving=()=>{obj.checkoutContainerObserver&&obj.checkoutContainerObserver.disconnect()},obj.bindScriptLoader=function(){const $script=$(obj.selectors.checkoutScript);if(0!==$(obj.selectors.paypalGatewayContainer).length)return $script.length?"undefined"!=typeof paypal?(obj.setupButtons({},$(tribe.tickets.commerce.selectors.checkoutContainer)),void obj.setupAdvancedPayments({},$(tribe.tickets.commerce.selectors.checkoutContainer))):void(window.onload=event=>{if("undefined"==typeof paypal)return obj.showNotice(),void $document.trigger(tribe.tickets.commerce.customEvents.hideLoader);obj.setupButtons(event,$(tribe.tickets.commerce.selectors.checkoutContainer))}):($document.trigger(tribe.tickets.commerce.customEvents.hideLoader),void obj.showNotice());$document.trigger(tribe.tickets.commerce.customEvents.hideLoader)},obj.setupAdvancedPayments=(event,$container)=>{paypal.HostedFields.isEligible()&&($container.find(obj.selectors.advancedPayments.container).removeClass(obj.selectors.hiddenElement.className()),paypal.HostedFields.render({createOrder:(data,actions)=>obj.handleCreateOrder(data,actions,$container),styles:{".invalid":{color:"#DA394D"},"input::placeholder":{color:"#999999"}},fields:{number:{selector:obj.selectors.advancedPayments.cardField,placeholder:obj.advancedPayments.fieldPlaceholders.number},cvv:{selector:obj.selectors.advancedPayments.cvvField,placeholder:obj.advancedPayments.fieldPlaceholders.cvv},expirationDate:{selector:obj.selectors.advancedPayments.expirationField,placeholder:obj.advancedPayments.fieldPlaceholders.expirationDate}}}).then((cardFields=>obj.handleHostedFields(cardFields,$container))))},obj.handleHostedFields=(cardFields,$container)=>{$container.find(obj.selectors.advancedPayments.form).on("submit",(event=>obj.onHostedSubmit(event,cardFields,$container)))},obj.getExtraCardFields=$container=>({cardholderName:$container.find(obj.selectors.advancedPayments.nameField).val()}),obj.onHostedSubmit=(event,cardFields,$container)=>{event.preventDefault(),tribe.tickets.loader.show($container),cardFields.submit(obj.getExtraCardFields($container)).then(((data,actions)=>{obj.handleHostedApprove(data,actions,$container)})).catch((error=>{obj.handleHostedCaptureError(error,$container)}))},obj.handleHostedCaptureError=(error,$container)=>{if(tribe.tickets.debug.log("handleHostedCaptureError",error),tribe.tickets.loader.hide($container),!obj.isGenericError)return void(obj.isGenericError=!0);let errorContent="";["INVALID_REQUEST","UNPROCESSABLE_ENTITY"].includes(error.name)&&(errorContent=error.message),"VALIDATION_ERROR"===error.name&&(errorContent=$("<div>"),Array.isArray(error.details)&&error.details.map((item=>{const $item=$("<p>").text(item.description);errorContent.append($item)}))),""!==errorContent&&obj.showNotice($container,"",errorContent)},obj.handleHostedApprove=function(data,actions,$container){tribe.tickets.debug.log("handleHostedApprove",arguments);return fetch(obj.orderEndpointUrl+"/"+data.orderId,{method:"POST",headers:{"X-WP-Nonce":$container.find(tribe.tickets.commerce.selectors.nonce).val(),"Content-Type":"application/json"},body:JSON.stringify({advanced_payment:!0})}).then((response=>response.json())).then((data=>(tribe.tickets.debug.log(data),data.success?obj.handleCheckSuccess(data,actions,$container):obj.handleHostedApproveFail(data,actions,$container)))).catch((error=>{obj.handleHostedApproveError(error,$container)}))},obj.handleHostedApproveSuccess=function(data,actions,$container){tribe.tickets.debug.log("handleHostedApproveSuccess",arguments),tribe.tickets.loader.hide($container),window.location.replace(data.redirect_url)},obj.handleHostedApproveFail=(data,actions,$container)=>{tribe.tickets.debug.log("handleHostedApproveFail",data,actions,$container),"UNPROCESSABLE_ENTITY"===data.data.name&&"INSTRUMENT_DECLINED"===data.data.details[0].issue?obj.showNotice($container,"",data.data.details[0].description):obj.showNotice($container,"",data.message),tribe.tickets.loader.hide($container)},obj.handleHostedApproveError=(error,$container,...rest)=>{tribe.tickets.loader.hide($container),tribe.tickets.debug.log("handleHostedApproveError",error,rest)},obj.ready=function(){obj.setupLoader(),obj.bindScriptLoader()},$(obj.ready)}(jQuery,tribe.tickets.commerce.gateway.paypal);